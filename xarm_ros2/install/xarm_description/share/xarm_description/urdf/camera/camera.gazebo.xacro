<?xml version="1.0"?>
<robot xmlns:xacro="http://www.ros.org/wiki/xacro">
  <xacro:macro name="rgb_camera_gz" params="
      prefix:=''
      attach_to:=''
      cam_name:='tcp_cam'
      cam_xyz:='0 0 0.02'
      cam_rpy:='0 0 0'
      width:='1280' height:='720' hfov:='1.0472'
      fps:='30' near:='0.1' far:='20.0'
      topic_ns:='/tcp_cam'
      visualize:=true">

    <!-- physical link to attach the sensor to -->
    <link name="${prefix}${cam_name}_link">
      <visual><geometry><sphere radius="0.002"/></geometry></visual>
    </link>

    <joint name="${prefix}${cam_name}_joint" type="fixed">
      <parent link="${attach_to}"/>
      <child  link="${prefix}${cam_name}_link"/>
      <origin xyz="${cam_xyz}" rpy="${cam_rpy}"/>
    </joint>

    <!-- Gazebo (GZ Sim) camera sensor -->
    <gazebo reference="${prefix}${cam_name}_link">
      <sensor name="${prefix}${cam_name}" type="camera">
        <always_on>1</always_on>
        <update_rate>${fps}</update_rate>
        <visualize>${visualize}</visualize>

        <!-- Gazebo Transport topics (we'll bridge these to ROS) -->
        <topic>${topic_ns}/image</topic>
        <camera>
          <horizontal_fov>${hfov}</horizontal_fov>
          <image>
            <width>${width}</width>
            <height>${height}</height>
            <format>R8G8B8</format>
          </image>
          <clip><near>${near}</near><far>${far}</far></clip>

          <!-- Optional in newer SDF: publish camera_info on a known topic -->
          <camera_info_topic>${topic_ns}/camera_info</camera_info_topic>
        </camera>
      </sensor>
    </gazebo>
  </xacro:macro>
</robot>
